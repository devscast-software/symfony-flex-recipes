{
    "manifests": {
        "symfony/phpunit-bridge": {
            "manifest": {
                "copy-from-recipe": {
                    ".env.test": ".env.test",
                    "bin/": "%BIN_DIR%/",
                    "phpunit.xml.dist": "phpunit.xml.dist",
                    "tests/": "tests/"
                },
                "gitignore": [
                    ".phpunit.result.cache",
                    "/phpunit.xml"
                ],
                "post-install-output": [
                    "  * installed from devscast"
                ]
            },
            "files": {
                ".env.test": {
                    "contents": [
                        "# define your env variables for the test env here",
                        "KERNEL_CLASS='Infrastructure\\Shared\\Symfony\\Kernel'",
                        "APP_SECRET='$ecretf0rt3st'",
                        "SYMFONY_DEPRECATIONS_HELPER=999999",
                        "PANTHER_APP_ENV=panther",
                        "PANTHER_ERROR_SCREENSHOT_DIR=./var/error-screenshots",
                        "DATABASE_URL=\"mysql://root:test@devscast_community_databasetest:3306/devscast?serverVersion=10.7.3-MariaDB&chartset=utf8\"",
                        ""
                    ],
                    "executable": false
                },
                "bin/phpunit": {
                    "contents": [
                        "#!/usr/bin/env php",
                        "<?php",
                        "",
                        "if (!ini_get('date.timezone')) {",
                        "    ini_set('date.timezone', 'UTC');",
                        "}",
                        "",
                        "if (is_file(dirname(__DIR__).'/vendor/phpunit/phpunit/phpunit')) {",
                        "    define('PHPUNIT_COMPOSER_INSTALL', dirname(__DIR__).'/vendor/autoload.php');",
                        "    require PHPUNIT_COMPOSER_INSTALL;",
                        "    PHPUnit\\TextUI\\Command::main();",
                        "} else {",
                        "    if (!is_file(dirname(__DIR__).'/vendor/symfony/phpunit-bridge/bin/simple-phpunit.php')) {",
                        "        echo \"Unable to find the `simple-phpunit.php` script in `vendor/symfony/phpunit-bridge/bin/`.\\n\";",
                        "        exit(1);",
                        "    }",
                        "",
                        "    require dirname(__DIR__).'/vendor/symfony/phpunit-bridge/bin/simple-phpunit.php';",
                        "}",
                        ""
                    ],
                    "executable": false
                },
                "phpunit.xml.dist": {
                    "contents": [
                        "<?xml version=\"1.0\" encoding=\"UTF-8\"?>",
                        "",
                        "<!-- https://phpunit.readthedocs.io/en/latest/configuration.html -->",
                        "<phpunit xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"",
                        "         xsi:noNamespaceSchemaLocation=\"vendor/phpunit/phpunit/phpunit.xsd\"",
                        "         backupGlobals=\"false\"",
                        "         colors=\"true\"",
                        "         bootstrap=\"tests/bootstrap.php\"",
                        "         convertDeprecationsToExceptions=\"false\"",
                        ">",
                        "    <php>",
                        "        <ini name=\"display_errors\" value=\"1\" />",
                        "        <ini name=\"error_reporting\" value=\"-1\" />",
                        "        <server name=\"APP_ENV\" value=\"test\" force=\"true\" />",
                        "        <server name=\"SHELL_VERBOSITY\" value=\"-1\" />",
                        "        <server name=\"SYMFONY_PHPUNIT_REMOVE\" value=\"\" />",
                        "        <server name=\"SYMFONY_PHPUNIT_VERSION\" value=\"9.5\" />",
                        "    </php>",
                        "",
                        "    <testsuites>",
                        "        <testsuite name=\"Project Test Suite\">",
                        "            <directory>tests</directory>",
                        "        </testsuite>",
                        "    </testsuites>",
                        "",
                        "    <coverage processUncoveredFiles=\"true\">",
                        "        <include>",
                        "            <directory suffix=\".php\">src</directory>",
                        "        </include>",
                        "    </coverage>",
                        "",
                        "    <listeners>",
                        "        <listener class=\"Symfony\\Bridge\\PhpUnit\\SymfonyTestsListener\" />",
                        "    </listeners>",
                        "",
                        "    <extensions>",
                        "        <extension class=\"Symfony\\Component\\Panther\\ServerExtension\" />",
                        "    </extensions>",
                        "</phpunit>",
                        ""
                    ],
                    "executable": false
                },
                "tests/Application/.gitignore": {
                    "contents": [
                        ""
                    ],
                    "executable": false
                },
                "tests/Domain/.gitignore": {
                    "contents": [
                        ""
                    ],
                    "executable": false
                },
                "tests/EventSubscriberTest.php": {
                    "contents": [
                        "<?php",
                        "",
                        "declare(strict_types=1);",
                        "",
                        "namespace Tests;",
                        "",
                        "use Symfony\\Bundle\\FrameworkBundle\\Test\\KernelTestCase;",
                        "use Symfony\\Component\\EventDispatcher\\EventDispatcher;",
                        "use Symfony\\Component\\EventDispatcher\\EventDispatcherInterface;",
                        "use Symfony\\Component\\EventDispatcher\\EventSubscriberInterface;",
                        "",
                        "/**",
                        " * Class EventSubscriberTest.",
                        " *",
                        " * @author bernard-ng <bernard@devscast.tech>",
                        " */",
                        "abstract class EventSubscriberTest extends KernelTestCase",
                        "{",
                        "    protected function dispatch(EventSubscriberInterface $subscriber, object $event): void",
                        "    {",
                        "        $dispatcher = new EventDispatcher();",
                        "        $dispatcher->addSubscriber($subscriber);",
                        "        $dispatcher->dispatch($event);",
                        "    }",
                        "",
                        "    /**",
                        "     * V\u00e9rifie qu'un subscriber \u00e9coute bien un \u00e9v\u00e8nement donn\u00e9e au niveau du kernel.",
                        "     */",
                        "    protected function assertSubscribeTo(string $subscriberClass, string $event): void",
                        "    {",
                        "        self::bootKernel();",
                        "        /** @var EventDispatcherInterface $dispatcher */",
                        "        $dispatcher = self::getContainer()->get(EventDispatcherInterface::class);",
                        "        $subscribers = $dispatcher->getListeners($event);",
                        "        // TODO : Ne fonctionne pour le moment qu'avec des subscribers, \u00e0 voir les listeners",
                        "        $subscribers = array_map(fn ($subscriber) => $subscriber[0]::class, $subscribers);",
                        "        $this->assertContains($subscriberClass, $subscribers);",
                        "    }",
                        "}",
                        ""
                    ],
                    "executable": false
                },
                "tests/FixturesTrait.php": {
                    "contents": [
                        "<?php",
                        "",
                        "declare(strict_types=1);",
                        "",
                        "namespace Tests;",
                        "",
                        "use Fidry\\AliceDataFixtures\\LoaderInterface;",
                        "",
                        "/**",
                        " * Trait FixturesTrait.",
                        " *",
                        " * @author bernard-ng <bernard@devscast.tech>",
                        " */",
                        "trait FixturesTrait",
                        "{",
                        "    /**",
                        "     * Charge une s\u00e9rie de fixture en base de donn\u00e9e et ajoute les entit\u00e9s \u00e0 l'EntityManager.",
                        "     *",
                        "     * @param array<string> $fixtures",
                        "     *",
                        "     * @return array<string,object>",
                        "     */",
                        "    public function loadFixtures(array $fixtures): array",
                        "    {",
                        "        $fixturePath = $this->getFixturesPath();",
                        "        $files = array_map(fn ($fixture) => PathHelper::join($fixturePath, $fixture . '.yaml'), $fixtures);",
                        "        /** @var LoaderInterface $loader */",
                        "        $loader = static::getContainer()->get('fidry_alice_data_fixtures.loader.doctrine');",
                        "",
                        "        return $loader->load($files);",
                        "    }",
                        "",
                        "    public function getFixturesPath(): string",
                        "    {",
                        "        return __DIR__ . '/fixtures/';",
                        "    }",
                        "}",
                        ""
                    ],
                    "executable": false
                },
                "tests/Infrastructure/.gitignore": {
                    "contents": [
                        ""
                    ],
                    "executable": false
                },
                "tests/KernelTestCase.php": {
                    "contents": [
                        "<?php",
                        "",
                        "declare(strict_types=1);",
                        "",
                        "namespace Tests;",
                        "",
                        "use Doctrine\\ORM\\EntityManagerInterface;",
                        "use Symfony\\Bundle\\FrameworkBundle\\KernelBrowser;",
                        "",
                        "/**",
                        " * Class KernelTestCase.",
                        " *",
                        " * @author bernard-ng <bernard@devscast.tech>",
                        " */",
                        "class KernelTestCase extends \\Symfony\\Bundle\\FrameworkBundle\\Test\\KernelTestCase",
                        "{",
                        "    protected KernelBrowser $client;",
                        "    protected EntityManagerInterface $em;",
                        "",
                        "    protected function setUp(): void",
                        "    {",
                        "        self::bootKernel();",
                        "        $this->em = self::getContainer()->get(EntityManagerInterface::class);",
                        "        parent::setUp();",
                        "    }",
                        "",
                        "    public function remove(object $entity): void",
                        "    {",
                        "        $this->em->remove($this->em->getRepository($entity::class)->find($entity->getId()));",
                        "    }",
                        "}",
                        ""
                    ],
                    "executable": false
                },
                "tests/PathHelper.php": {
                    "contents": [
                        "<?php",
                        "",
                        "declare(strict_types=1);",
                        "",
                        "namespace Tests;",
                        "",
                        "/**",
                        " * Class PathHelper.",
                        " *",
                        " * @author bernard-ng <bernard@devscast.tech>",
                        " */",
                        "final class PathHelper",
                        "{",
                        "    public static function join(string ...$parts): string",
                        "    {",
                        "        return preg_replace(",
                        "            pattern: '~[/\\\\\\\\]+~',",
                        "            replacement: DIRECTORY_SEPARATOR,",
                        "            subject: implode(DIRECTORY_SEPARATOR, $parts)",
                        "        ) ?: '';",
                        "    }",
                        "}",
                        ""
                    ],
                    "executable": false
                },
                "tests/RepositoryTestCase.php": {
                    "contents": [
                        "<?php",
                        "",
                        "declare(strict_types=1);",
                        "",
                        "namespace Tests;",
                        "",
                        "use Doctrine\\Bundle\\DoctrineBundle\\Repository\\ServiceEntityRepository;",
                        "",
                        "/**",
                        " * Class RepositoryTestCase.",
                        " *",
                        " * @author bernard-ng <bernard@devscast.tech>",
                        " */",
                        "class RepositoryTestCase extends KernelTestCase",
                        "{",
                        "    protected ?ServiceEntityRepository $repository = null;",
                        "    protected ?string $repositoryClass = null;",
                        "",
                        "    protected function setUp(): void",
                        "    {",
                        "        parent::setUp();",
                        "        $this->repository = self::getContainer()->get($this->repositoryClass);",
                        "    }",
                        "}",
                        ""
                    ],
                    "executable": false
                },
                "tests/ValidatorTestCase.php": {
                    "contents": [
                        "<?php",
                        "",
                        "declare(strict_types=1);",
                        "",
                        "namespace Tests;",
                        "",
                        "use Symfony\\Component\\Validator\\Context\\ExecutionContextInterface;",
                        "use Symfony\\Component\\Validator\\Violation\\ConstraintViolationBuilderInterface;",
                        "",
                        "/**",
                        " * Class ValidatorTestCase.",
                        " *",
                        " * @author bernard-ng <bernard@devscast.tech>",
                        " */",
                        "class ValidatorTestCase extends KernelTestCase",
                        "{",
                        "    /**",
                        "     * G\u00e9n\u00e8re un contexte qui attend (ou non) une violation.",
                        "     */",
                        "    protected function getContext(bool $expectedViolation): ExecutionContextInterface",
                        "    {",
                        "        $context = $this->getMockBuilder(ExecutionContextInterface::class)->getMock();",
                        "        if ($expectedViolation) {",
                        "            $violation = $this->getMockBuilder(ConstraintViolationBuilderInterface::class)->getMock();",
                        "            $violation->expects($this->any())->method('setParameter')->willReturn($violation);",
                        "            $violation->expects($this->any())->method('setCode')->willReturn($violation);",
                        "            $violation->expects($this->any())->method('atPath')->willReturn($violation);",
                        "            $violation->expects($this->once())->method('addViolation');",
                        "            $context",
                        "                ->expects($this->once())",
                        "                ->method('buildViolation')",
                        "                ->willReturn($violation);",
                        "        } else {",
                        "            $context",
                        "                ->expects($this->never())",
                        "                ->method('buildViolation');",
                        "        }",
                        "",
                        "        return $context;",
                        "    }",
                        "}",
                        ""
                    ],
                    "executable": false
                },
                "tests/WebTestCase.php": {
                    "contents": [
                        "<?php",
                        "",
                        "declare(strict_types=1);",
                        "",
                        "namespace Tests;",
                        "",
                        "use Doctrine\\ORM\\EntityManagerInterface;",
                        "use Symfony\\Bundle\\FrameworkBundle\\KernelBrowser;",
                        "use Symfony\\Component\\Security\\Core\\User\\UserInterface;",
                        "use Symfony\\Component\\Security\\Csrf\\TokenStorage\\TokenStorageInterface;",
                        "",
                        "/**",
                        " * Class WebTestCase.",
                        " *",
                        " * @author bernard-ng <bernard@devscast.tech>",
                        " */",
                        "class WebTestCase extends \\Symfony\\Bundle\\FrameworkBundle\\Test\\WebTestCase",
                        "{",
                        "    protected KernelBrowser $client;",
                        "    protected EntityManagerInterface $em;",
                        "",
                        "    /**",
                        "     * @author bernard-ng <bernard@devscast.tech>",
                        "     */",
                        "    protected function setUp(): void",
                        "    {",
                        "        $this->client = self::createClient();",
                        "        /** @var EntityManagerInterface $em */",
                        "        $em = self::getContainer()->get(EntityManagerInterface::class);",
                        "        $this->em = $em;",
                        "        parent::setUp();",
                        "    }",
                        "",
                        "    /**",
                        "     * @author bernard-ng <bernard@devscast.tech>",
                        "     */",
                        "    protected function tearDown(): void",
                        "    {",
                        "        $this->em->clear();",
                        "        parent::tearDown();",
                        "    }",
                        "",
                        "    /**",
                        "     * @author bernard-ng <bernard@devscast.tech>",
                        "     */",
                        "    public function jsonRequest(string $method, string $url, ?array $data = null): string",
                        "    {",
                        "        $this->client->request($method, $url, [], [], [",
                        "            'CONTENT_TYPE' => 'application/json',",
                        "            'HTTP_Accept' => 'application/json',",
                        "        ], $data ? json_encode($data, JSON_THROW_ON_ERROR) : null);",
                        "",
                        "        return $this->client->getResponse()->getContent();",
                        "    }",
                        "",
                        "    /**",
                        "     * V\u00e9rifie si on a un message d'erreur.",
                        "     */",
                        "    public function expectErrorAlert(): void",
                        "    {",
                        "        $this->assertEquals(",
                        "            1,",
                        "            $this->client",
                        "                ->getCrawler()",
                        "                ->filter('div[type=\"error\"], app-toast[type=\"error\"]')",
                        "                ->count(),",
                        "            'Error Alert mismatch'",
                        "        );",
                        "    }",
                        "",
                        "    /**",
                        "     * V\u00e9rifie si on a un message de succ\u00e8s.",
                        "     */",
                        "    public function expectSuccessAlert(): void",
                        "    {",
                        "        $this->assertEquals(",
                        "            1,",
                        "            $this->client",
                        "                ->getCrawler()",
                        "                ->filter('div[type=\"success\"], app-toast[type=\"success\"]')",
                        "                ->count(),",
                        "            'Success Alert mismatch'",
                        "        );",
                        "    }",
                        "",
                        "    /**",
                        "     * @author bernard-ng <bernard@devscast.tech>",
                        "     */",
                        "    public function expectFormErrors(?int $expectedErrors = null): void",
                        "    {",
                        "        if (null === $expectedErrors) {",
                        "            $this->assertTrue(",
                        "                $this->client",
                        "                    ->getCrawler()",
                        "                    ->filter('.form-error-message')",
                        "                    ->count() > 0,",
                        "                'Form errors mismatch.'",
                        "            );",
                        "        } else {",
                        "            $this->assertEquals(",
                        "                $expectedErrors,",
                        "                $this->client",
                        "                    ->getCrawler()",
                        "                    ->filter('.form-error-message')",
                        "                    ->count(),",
                        "                'Form errors mismatch.'",
                        "            );",
                        "        }",
                        "    }",
                        "",
                        "    /**",
                        "     * @author bernard-ng <bernard@devscast.tech>",
                        "     */",
                        "    public function expectH1(string $title): void",
                        "    {",
                        "        $crawler = $this->client->getCrawler();",
                        "        $this->assertEquals(",
                        "            $title,",
                        "            $crawler->filter('h1')->text(),",
                        "            '<h1> mismatch'",
                        "        );",
                        "    }",
                        "",
                        "    /**",
                        "     * @author bernard-ng <bernard@devscast.tech>",
                        "     */",
                        "    public function expectTitle(string $title): void",
                        "    {",
                        "        $crawler = $this->client->getCrawler();",
                        "        $this->assertEquals(",
                        "            $title . ' | Devscast Community',",
                        "            $crawler->filter('title')->text(),",
                        "            '<title> mismatch',",
                        "        );",
                        "    }",
                        "",
                        "    /**",
                        "     * @author bernard-ng <bernard@devscast.tech>",
                        "     */",
                        "    public function login(?UserInterface $user)",
                        "    {",
                        "        if (null === $user) {",
                        "            return;",
                        "        }",
                        "        $this->client->loginUser($user);",
                        "    }",
                        "",
                        "    /**",
                        "     * @author bernard-ng <bernard@devscast.tech>",
                        "     */",
                        "    public function setCsrf(string $key): string",
                        "    {",
                        "        $csrf = uniqid();",
                        "        self::getContainer()->get(TokenStorageInterface::class)->setToken($key, $csrf);",
                        "",
                        "        return $csrf;",
                        "    }",
                        "}",
                        ""
                    ],
                    "executable": false
                },
                "tests/bootstrap.php": {
                    "contents": [
                        "<?php",
                        "",
                        "declare(strict_types=1);",
                        "",
                        "use Symfony\\Component\\Dotenv\\Dotenv;",
                        "",
                        "require dirname(__DIR__) . '/vendor/autoload.php';",
                        "",
                        "if (file_exists(dirname(__DIR__) . '/config/bootstrap.php')) {",
                        "    require dirname(__DIR__) . '/config/bootstrap.php';",
                        "} elseif (method_exists(Dotenv::class, 'bootEnv')) {",
                        "    (new Dotenv())->bootEnv(dirname(__DIR__) . '/.env');",
                        "}",
                        ""
                    ],
                    "executable": false
                },
                "tests/fixtures/.gitignore": {
                    "contents": [
                        ""
                    ],
                    "executable": false
                },
                "tests/object-manager.php": {
                    "contents": [
                        "<?php",
                        "",
                        "declare(strict_types=1);",
                        "",
                        "use Infrastructure\\Shared\\Symfony\\Kernel;",
                        "use Symfony\\Component\\Dotenv\\Dotenv;",
                        "",
                        "require __DIR__ . '/../vendor/autoload.php';",
                        "",
                        "(new Dotenv())->bootEnv(__DIR__ . '/../.env');",
                        "",
                        "$kernel = new Kernel($_SERVER['APP_ENV'], (bool) $_SERVER['APP_DEBUG']);",
                        "$kernel->boot();",
                        "",
                        "return $kernel->getContainer()->get('doctrine')->getManager();",
                        ""
                    ],
                    "executable": false
                }
            },
            "ref": "c22e420dbe3364cf1c5c984e57a3d4d76a276aa2"
        }
    }
}
